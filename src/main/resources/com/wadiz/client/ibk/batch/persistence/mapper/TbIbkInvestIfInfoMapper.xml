<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wadiz.client.ibk.batch.persistence.TbIbkInvestIfInfoMapper" >
  <resultMap id="BaseResultMap" type="com.wadiz.client.ibk.batch.model.TbIbkInvestIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    <id column="IfId" property="ifId" jdbcType="INTEGER" />
    <result column="IfCode" property="ifCode" jdbcType="CHAR" />
    <result column="DataType" property="dataType" jdbcType="CHAR" />
    <result column="Seq" property="seq" jdbcType="TINYINT" />
    <result column="PayType" property="payType" jdbcType="CHAR" />
    <result column="CampaignId" property="campaignId" jdbcType="VARCHAR" />
    <result column="OfferName" property="offerName" jdbcType="VARCHAR" />
    <result column="InvestId" property="investId" jdbcType="INTEGER" />
    <result column="InvestAmount" property="investAmount" jdbcType="VARCHAR" />
    <result column="UserId" property="userId" jdbcType="INTEGER" />
    <result column="PaymentsOfStocksYn" property="paymentsOfStocksYn" jdbcType="CHAR" />
    <result column="PayReqDate" property="payReqDate" jdbcType="VARCHAR" />
    <result column="PayReqTime" property="payReqTime" jdbcType="VARCHAR" />
    <result column="ProcStatus" property="procStatus" jdbcType="CHAR" />
    <result column="RegDate" property="regDate" jdbcType="TIMESTAMP" />
    <result column="ReqDate" property="reqDate" jdbcType="TIMESTAMP" />
    <result column="ResDate" property="resDate" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    IfId, IfCode, DataType, Seq, PayType, CampaignId, OfferName, InvestId, InvestAmount, 
    UserId, PaymentsOfStocksYn, PayReqDate, PayReqTime, ProcStatus, RegDate, ReqDate, 
    ResDate
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from TbIbkInvestIfInfo
    where IfId = #{ifId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    delete from TbIbkInvestIfInfo
    where IfId = #{ifId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.wadiz.client.ibk.batch.model.TbIbkInvestIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    insert into TbIbkInvestIfInfo (IfId, IfCode, DataType, 
      Seq, PayType, CampaignId, 
      OfferName, InvestId, InvestAmount, 
      UserId, PaymentsOfStocksYn, PayReqDate, 
      PayReqTime, ProcStatus, RegDate, 
      ReqDate, ResDate)
    values (#{ifId,jdbcType=INTEGER}, #{ifCode,jdbcType=CHAR}, #{dataType,jdbcType=CHAR}, 
      #{seq,jdbcType=TINYINT}, #{payType,jdbcType=CHAR}, #{campaignId,jdbcType=VARCHAR}, 
      #{offerName,jdbcType=VARCHAR}, #{investId,jdbcType=INTEGER}, #{investAmount,jdbcType=VARCHAR}, 
      #{userId,jdbcType=INTEGER}, #{paymentsOfStocksYn,jdbcType=CHAR}, #{payReqDate,jdbcType=VARCHAR}, 
      #{payReqTime,jdbcType=VARCHAR}, #{procStatus,jdbcType=CHAR}, #{regDate,jdbcType=TIMESTAMP}, 
      #{reqDate,jdbcType=TIMESTAMP}, #{resDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.wadiz.client.ibk.batch.model.TbIbkInvestIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    insert into TbIbkInvestIfInfo
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="ifId != null" >
        IfId,
      </if>
      <if test="ifCode != null" >
        IfCode,
      </if>
      <if test="dataType != null" >
        DataType,
      </if>
      <if test="seq != null" >
        Seq,
      </if>
      <if test="payType != null" >
        PayType,
      </if>
      <if test="campaignId != null" >
        CampaignId,
      </if>
      <if test="offerName != null" >
        OfferName,
      </if>
      <if test="investId != null" >
        InvestId,
      </if>
      <if test="investAmount != null" >
        InvestAmount,
      </if>
      <if test="userId != null" >
        UserId,
      </if>
      <if test="paymentsOfStocksYn != null" >
        PaymentsOfStocksYn,
      </if>
      <if test="payReqDate != null" >
        PayReqDate,
      </if>
      <if test="payReqTime != null" >
        PayReqTime,
      </if>
      <if test="procStatus != null" >
        ProcStatus,
      </if>
      <if test="regDate != null" >
        RegDate,
      </if>
      <if test="reqDate != null" >
        ReqDate,
      </if>
      <if test="resDate != null" >
        ResDate,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="ifId != null" >
        #{ifId,jdbcType=INTEGER},
      </if>
      <if test="ifCode != null" >
        #{ifCode,jdbcType=CHAR},
      </if>
      <if test="dataType != null" >
        #{dataType,jdbcType=CHAR},
      </if>
      <if test="seq != null" >
        #{seq,jdbcType=TINYINT},
      </if>
      <if test="payType != null" >
        #{payType,jdbcType=CHAR},
      </if>
      <if test="campaignId != null" >
        #{campaignId,jdbcType=VARCHAR},
      </if>
      <if test="offerName != null" >
        #{offerName,jdbcType=VARCHAR},
      </if>
      <if test="investId != null" >
        #{investId,jdbcType=INTEGER},
      </if>
      <if test="investAmount != null" >
        #{investAmount,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="paymentsOfStocksYn != null" >
        #{paymentsOfStocksYn,jdbcType=CHAR},
      </if>
      <if test="payReqDate != null" >
        #{payReqDate,jdbcType=VARCHAR},
      </if>
      <if test="payReqTime != null" >
        #{payReqTime,jdbcType=VARCHAR},
      </if>
      <if test="procStatus != null" >
        #{procStatus,jdbcType=CHAR},
      </if>
      <if test="regDate != null" >
        #{regDate,jdbcType=TIMESTAMP},
      </if>
      <if test="reqDate != null" >
        #{reqDate,jdbcType=TIMESTAMP},
      </if>
      <if test="resDate != null" >
        #{resDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.wadiz.client.ibk.batch.model.TbIbkInvestIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    update TbIbkInvestIfInfo
    <set >
      <if test="ifCode != null" >
        IfCode = #{ifCode,jdbcType=CHAR},
      </if>
      <if test="dataType != null" >
        DataType = #{dataType,jdbcType=CHAR},
      </if>
      <if test="seq != null" >
        Seq = #{seq,jdbcType=TINYINT},
      </if>
      <if test="payType != null" >
        PayType = #{payType,jdbcType=CHAR},
      </if>
      <if test="campaignId != null" >
        CampaignId = #{campaignId,jdbcType=VARCHAR},
      </if>
      <if test="offerName != null" >
        OfferName = #{offerName,jdbcType=VARCHAR},
      </if>
      <if test="investId != null" >
        InvestId = #{investId,jdbcType=INTEGER},
      </if>
      <if test="investAmount != null" >
        InvestAmount = #{investAmount,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        UserId = #{userId,jdbcType=INTEGER},
      </if>
      <if test="paymentsOfStocksYn != null" >
        PaymentsOfStocksYn = #{paymentsOfStocksYn,jdbcType=CHAR},
      </if>
      <if test="payReqDate != null" >
        PayReqDate = #{payReqDate,jdbcType=VARCHAR},
      </if>
      <if test="payReqTime != null" >
        PayReqTime = #{payReqTime,jdbcType=VARCHAR},
      </if>
      <if test="procStatus != null" >
        ProcStatus = #{procStatus,jdbcType=CHAR},
      </if>
      <if test="regDate != null" >
        RegDate = #{regDate,jdbcType=TIMESTAMP},
      </if>
      <if test="reqDate != null" >
        ReqDate = #{reqDate,jdbcType=TIMESTAMP},
      </if>
      <if test="resDate != null" >
        ResDate = #{resDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where IfId = #{ifId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.wadiz.client.ibk.batch.model.TbIbkInvestIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    update TbIbkInvestIfInfo
    set IfCode = #{ifCode,jdbcType=CHAR},
      DataType = #{dataType,jdbcType=CHAR},
      Seq = #{seq,jdbcType=TINYINT},
      PayType = #{payType,jdbcType=CHAR},
      CampaignId = #{campaignId,jdbcType=VARCHAR},
      OfferName = #{offerName,jdbcType=VARCHAR},
      InvestId = #{investId,jdbcType=INTEGER},
      InvestAmount = #{investAmount,jdbcType=VARCHAR},
      UserId = #{userId,jdbcType=INTEGER},
      PaymentsOfStocksYn = #{paymentsOfStocksYn,jdbcType=CHAR},
      PayReqDate = #{payReqDate,jdbcType=VARCHAR},
      PayReqTime = #{payReqTime,jdbcType=VARCHAR},
      ProcStatus = #{procStatus,jdbcType=CHAR},
      RegDate = #{regDate,jdbcType=TIMESTAMP},
      ReqDate = #{reqDate,jdbcType=TIMESTAMP},
      ResDate = #{resDate,jdbcType=TIMESTAMP}
    where IfId = #{ifId,jdbcType=INTEGER}
  </update>
  
  <update id="updateProcStatus" parameterType="string" >
    update TbIbkInvestIfInfo
    set ProcStatus = #{procStatus}
    where ProcStatus = 'R'
  </update>
  
  <select id="selectSbcrList" resultMap="BaseResultMap" parameterType="map" >
    select  @ROWNUM := @ROWNUM + 1 AS Seq, X.* from  (
		select 'N' PaymentsOfStocksYn, case A.InvPayType when 'P10' THEN '0200' else '0220' end IfCode, A.CampaignId, A.InvestId, A.UserId, A.InvestAmount, B.DisplayName OfferName, replace(date(A.UpdateDate),'-','') PayReqDate, replace(time(A.UpdateDate),':','') PayReqTime 
		from TbInvest A
		inner join TbSecurt B on A.CampaignId=B.CampaignId
		left outer join TbInvestCancel C on A.InvestId=C.InvestId
		where C.InvestId IS NULL and A.UserIvstSt = 'IC10' and A.DpsOrgnztn = 'DPS0000002' and A.PayDate=replace(#{date},'-','') and A.InvPayType=#{payType}
	) X, (SELECT @ROWNUM := 0) R
  </select> 

  <select id="selectCompletedInvestList" resultMap="BaseResultMap" parameterType="int">
  	 select  @ROWNUM := @ROWNUM + 1 AS Seq, X.* from  (
		select 'Y' paymentsOfStocksYn, A.CampaignId, A.InvestId, A.UserId, A.InvestAmount, B.DisplayName OfferName, replace(date(A.RegDate),'-','') PayReqDate, replace(time(A.RegDate),':','') PayReqTime 
		from TbInvest A
		inner join TbSecurt B ON A.CampaignId=B.CampaignId
		where A.UserIvstSt = 'ID10' and A.DpsOrgnztn = 'DPS0000002' and A.CampaignId=#{campaignId} 
	) X, (SELECT @ROWNUM := 0) R
  </select>
  <select id="selectInvestIfInfo" resultMap="BaseResultMap" parameterType="int">
  	select 
    <include refid="Base_Column_List" />
    from TbIbkInvestIfInfo
    where InvestId = #{investId,jdbcType=INTEGER}
    limit 1
  </select>
  
  <update id="updateResultInvest" parameterType="com.wadiz.client.ibk.batch.model.TbIbkInvestIfInfo">
    update TbIbkInvestIfInfo
    set ProcStatus = #{procStatus,jdbcType=CHAR},
      ResDate = now()
    where CampaignId = #{campaignId,jdbcType=VARCHAR} and InvestId = #{investId,jdbcType=INTEGER}
  </update>
</mapper>