<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wadiz.client.ibk.batch.persistence.TbIbkOfferIfInfoMapper" >
  <resultMap id="BaseResultMap" type="com.wadiz.client.ibk.batch.model.TbIbkOfferIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    <id column="IfId" property="ifId" jdbcType="INTEGER" />
    <result column="IfCode" property="ifCode" jdbcType="CHAR" />
    <result column="DataType" property="dataType" jdbcType="CHAR" />
    <result column="Seq" property="seq" jdbcType="TINYINT" />
    <result column="BankCode" property="bankCode" jdbcType="CHAR" />
    <result column="TranCompId" property="tranCompId" jdbcType="CHAR" />
    <result column="CampaignId" property="campaignId" jdbcType="VARCHAR" />
    <result column="OfferName" property="offerName" jdbcType="VARCHAR" />
    <result column="IssuCorpName" property="issuCorpName" jdbcType="VARCHAR" />
    <result column="BusinessRegNumber" property="businessRegNumber" jdbcType="VARCHAR" />
    <result column="SecurtType" property="securtType" jdbcType="CHAR" />
    <result column="TargetAmount" property="targetAmount" jdbcType="VARCHAR" />
    <result column="PeriodStartDate" property="periodStartDate" jdbcType="VARCHAR" />
    <result column="PeriodFinishDate" property="periodFinishDate" jdbcType="VARCHAR" />
    <result column="RefundDate" property="refundDate" jdbcType="VARCHAR" />
    <result column="PaymentDate" property="paymentDate" jdbcType="VARCHAR" />
    <result column="ReceiptAccountNo" property="receiptAccountNo" jdbcType="VARCHAR" />
    <result column="ReceiptDepositor" property="receiptDepositor" jdbcType="VARCHAR" />
    <result column="ProcType" property="procType" jdbcType="CHAR" />
    <result column="ProcStatus" property="procStatus" jdbcType="CHAR" />
    <result column="RegDate" property="regDate" jdbcType="TIMESTAMP" />
    <result column="ReqDate" property="reqDate" jdbcType="TIMESTAMP" />
    <result column="ResDate" property="resDate" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    IfId, IfCode, DataType, Seq, BankCode, TranCompId, CampaignId, OfferName, IssuCorpName, 
    BusinessRegNumber, SecurtType, TargetAmount, PeriodStartDate, PeriodFinishDate, RefundDate, 
    PaymentDate, ReceiptAccountNo, ReceiptDepositor, ProcType, ProcStatus, RegDate, ReqDate, 
    ResDate
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from TbIbkOfferIfInfo
    where IfId = #{ifId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    delete from TbIbkOfferIfInfo
    where IfId = #{ifId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.wadiz.client.ibk.batch.model.TbIbkOfferIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    insert into TbIbkOfferIfInfo (IfId, IfCode, DataType, 
      Seq, BankCode, TranCompId, 
      CampaignId, OfferName, IssuCorpName, 
      BusinessRegNumber, SecurtType, TargetAmount, 
      PeriodStartDate, PeriodFinishDate, RefundDate, 
      PaymentDate, ReceiptAccountNo, ReceiptDepositor, 
      ProcType, ProcStatus, RegDate, 
      ReqDate, ResDate)
    values (#{ifId,jdbcType=INTEGER}, #{ifCode,jdbcType=CHAR}, #{dataType,jdbcType=CHAR}, 
      #{seq,jdbcType=TINYINT}, #{bankCode,jdbcType=CHAR}, #{tranCompId,jdbcType=CHAR}, 
      #{campaignId,jdbcType=VARCHAR}, #{offerName,jdbcType=VARCHAR}, #{issuCorpName,jdbcType=VARCHAR}, 
      #{businessRegNumber,jdbcType=VARCHAR}, #{securtType,jdbcType=CHAR}, #{targetAmount,jdbcType=VARCHAR}, 
      #{periodStartDate,jdbcType=VARCHAR}, #{periodFinishDate,jdbcType=VARCHAR}, #{refundDate,jdbcType=VARCHAR}, 
      #{paymentDate,jdbcType=VARCHAR}, #{receiptAccountNo,jdbcType=VARCHAR}, #{receiptDepositor,jdbcType=VARCHAR}, 
      #{procType,jdbcType=CHAR}, #{procStatus,jdbcType=CHAR}, #{regDate,jdbcType=TIMESTAMP}, 
      #{reqDate,jdbcType=TIMESTAMP}, #{resDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.wadiz.client.ibk.batch.model.TbIbkOfferIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    insert into TbIbkOfferIfInfo
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="ifId != null" >
        IfId,
      </if>
      <if test="ifCode != null" >
        IfCode,
      </if>
      <if test="dataType != null" >
        DataType,
      </if>
      <if test="seq != null" >
        Seq,
      </if>
      <if test="bankCode != null" >
        BankCode,
      </if>
      <if test="tranCompId != null" >
        TranCompId,
      </if>
      <if test="campaignId != null" >
        CampaignId,
      </if>
      <if test="offerName != null" >
        OfferName,
      </if>
      <if test="issuCorpName != null" >
        IssuCorpName,
      </if>
      <if test="businessRegNumber != null" >
        BusinessRegNumber,
      </if>
      <if test="securtType != null" >
        SecurtType,
      </if>
      <if test="targetAmount != null" >
        TargetAmount,
      </if>
      <if test="periodStartDate != null" >
        PeriodStartDate,
      </if>
      <if test="periodFinishDate != null" >
        PeriodFinishDate,
      </if>
      <if test="refundDate != null" >
        RefundDate,
      </if>
      <if test="paymentDate != null" >
        PaymentDate,
      </if>
      <if test="receiptAccountNo != null" >
        ReceiptAccountNo,
      </if>
      <if test="receiptDepositor != null" >
        ReceiptDepositor,
      </if>
      <if test="procType != null" >
        ProcType,
      </if>
      <if test="procStatus != null" >
        ProcStatus,
      </if>
      <if test="regDate != null" >
        RegDate,
      </if>
      <if test="reqDate != null" >
        ReqDate,
      </if>
      <if test="resDate != null" >
        ResDate,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="ifId != null" >
        #{ifId,jdbcType=INTEGER},
      </if>
      <if test="ifCode != null" >
        #{ifCode,jdbcType=CHAR},
      </if>
      <if test="dataType != null" >
        #{dataType,jdbcType=CHAR},
      </if>
      <if test="seq != null" >
        #{seq,jdbcType=TINYINT},
      </if>
      <if test="bankCode != null" >
        #{bankCode,jdbcType=CHAR},
      </if>
      <if test="tranCompId != null" >
        #{tranCompId,jdbcType=CHAR},
      </if>
      <if test="campaignId != null" >
        #{campaignId,jdbcType=VARCHAR},
      </if>
      <if test="offerName != null" >
        #{offerName,jdbcType=VARCHAR},
      </if>
      <if test="issuCorpName != null" >
        #{issuCorpName,jdbcType=VARCHAR},
      </if>
      <if test="businessRegNumber != null" >
        #{businessRegNumber,jdbcType=VARCHAR},
      </if>
      <if test="securtType != null" >
        #{securtType,jdbcType=CHAR},
      </if>
      <if test="targetAmount != null" >
        #{targetAmount,jdbcType=VARCHAR},
      </if>
      <if test="periodStartDate != null" >
        #{periodStartDate,jdbcType=VARCHAR},
      </if>
      <if test="periodFinishDate != null" >
        #{periodFinishDate,jdbcType=VARCHAR},
      </if>
      <if test="refundDate != null" >
        #{refundDate,jdbcType=VARCHAR},
      </if>
      <if test="paymentDate != null" >
        #{paymentDate,jdbcType=VARCHAR},
      </if>
      <if test="receiptAccountNo != null" >
        #{receiptAccountNo,jdbcType=VARCHAR},
      </if>
      <if test="receiptDepositor != null" >
        #{receiptDepositor,jdbcType=VARCHAR},
      </if>
      <if test="procType != null" >
        #{procType,jdbcType=CHAR},
      </if>
      <if test="procStatus != null" >
        #{procStatus,jdbcType=CHAR},
      </if>
      <if test="regDate != null" >
        #{regDate,jdbcType=TIMESTAMP},
      </if>
      <if test="reqDate != null" >
        #{reqDate,jdbcType=TIMESTAMP},
      </if>
      <if test="resDate != null" >
        #{resDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.wadiz.client.ibk.batch.model.TbIbkOfferIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    update TbIbkOfferIfInfo
    <set >
      <if test="ifCode != null" >
        IfCode = #{ifCode,jdbcType=CHAR},
      </if>
      <if test="dataType != null" >
        DataType = #{dataType,jdbcType=CHAR},
      </if>
      <if test="seq != null" >
        Seq = #{seq,jdbcType=TINYINT},
      </if>
      <if test="bankCode != null" >
        BankCode = #{bankCode,jdbcType=CHAR},
      </if>
      <if test="tranCompId != null" >
        TranCompId = #{tranCompId,jdbcType=CHAR},
      </if>
      <if test="campaignId != null" >
        CampaignId = #{campaignId,jdbcType=VARCHAR},
      </if>
      <if test="offerName != null" >
        OfferName = #{offerName,jdbcType=VARCHAR},
      </if>
      <if test="issuCorpName != null" >
        IssuCorpName = #{issuCorpName,jdbcType=VARCHAR},
      </if>
      <if test="businessRegNumber != null" >
        BusinessRegNumber = #{businessRegNumber,jdbcType=VARCHAR},
      </if>
      <if test="securtType != null" >
        SecurtType = #{securtType,jdbcType=CHAR},
      </if>
      <if test="targetAmount != null" >
        TargetAmount = #{targetAmount,jdbcType=VARCHAR},
      </if>
      <if test="periodStartDate != null" >
        PeriodStartDate = #{periodStartDate,jdbcType=VARCHAR},
      </if>
      <if test="periodFinishDate != null" >
        PeriodFinishDate = #{periodFinishDate,jdbcType=VARCHAR},
      </if>
      <if test="refundDate != null" >
        RefundDate = #{refundDate,jdbcType=VARCHAR},
      </if>
      <if test="paymentDate != null" >
        PaymentDate = #{paymentDate,jdbcType=VARCHAR},
      </if>
      <if test="receiptAccountNo != null" >
        ReceiptAccountNo = #{receiptAccountNo,jdbcType=VARCHAR},
      </if>
      <if test="receiptDepositor != null" >
        ReceiptDepositor = #{receiptDepositor,jdbcType=VARCHAR},
      </if>
      <if test="procType != null" >
        ProcType = #{procType,jdbcType=CHAR},
      </if>
      <if test="procStatus != null" >
        ProcStatus = #{procStatus,jdbcType=CHAR},
      </if>
      <if test="regDate != null" >
        RegDate = #{regDate,jdbcType=TIMESTAMP},
      </if>
      <if test="reqDate != null" >
        ReqDate = #{reqDate,jdbcType=TIMESTAMP},
      </if>
      <if test="resDate != null" >
        ResDate = #{resDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where IfId = #{ifId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.wadiz.client.ibk.batch.model.TbIbkOfferIfInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jan 06 16:00:21 KST 2016.
    -->
    update TbIbkOfferIfInfo
    set IfCode = #{ifCode,jdbcType=CHAR},
      DataType = #{dataType,jdbcType=CHAR},
      Seq = #{seq,jdbcType=TINYINT},
      BankCode = #{bankCode,jdbcType=CHAR},
      TranCompId = #{tranCompId,jdbcType=CHAR},
      CampaignId = #{campaignId,jdbcType=VARCHAR},
      OfferName = #{offerName,jdbcType=VARCHAR},
      IssuCorpName = #{issuCorpName,jdbcType=VARCHAR},
      BusinessRegNumber = #{businessRegNumber,jdbcType=VARCHAR},
      SecurtType = #{securtType,jdbcType=CHAR},
      TargetAmount = #{targetAmount,jdbcType=VARCHAR},
      PeriodStartDate = #{periodStartDate,jdbcType=VARCHAR},
      PeriodFinishDate = #{periodFinishDate,jdbcType=VARCHAR},
      RefundDate = #{refundDate,jdbcType=VARCHAR},
      PaymentDate = #{paymentDate,jdbcType=VARCHAR},
      ReceiptAccountNo = #{receiptAccountNo,jdbcType=VARCHAR},
      ReceiptDepositor = #{receiptDepositor,jdbcType=VARCHAR},
      ProcType = #{procType,jdbcType=CHAR},
      ProcStatus = #{procStatus,jdbcType=CHAR},
      RegDate = #{regDate,jdbcType=TIMESTAMP},
      ReqDate = #{reqDate,jdbcType=TIMESTAMP},
      ResDate = #{resDate,jdbcType=TIMESTAMP}
    where IfId = #{ifId,jdbcType=INTEGER}
  </update>

  <select id="selectConfirmedOfferList" resultMap="BaseResultMap" parameterType="string" >
 	select @ROWNUM := @ROWNUM + 1 AS Seq, X.* from (
	    select  
	    	A.CampaignId, replace(PeriodStartDate,'-','') PeriodStartDate, replace(PeriodFinishDate, '-','') PeriodFinishDate, 
	    	left(replace(B.BusinessRegNumber,'-',''),10) businessRegNumber, B.CorpName IssuCorpName, C.DisplayName OfferName, 
	    	ReceiptDepositor, ReceiptAccountNo  , D.TargetAmount , DATE_FORMAT(date_add(PeriodFinishDate, interval +8 day),'%Y%m%d') PaymentDate,
			DATE_FORMAT(date_add(PeriodFinishDate, interval +8 day),'%Y%m%d') as RefundDate,
			CASE A.SecurtType
				WHEN 'equity' THEN '01'
				WHEN 'bond'   THEN '02'
				ELSE '03'
			END as SecurtType
		from TbCampaignBaseInfo A
		inner join TbBusinessLicenseInfo B on A.BusinessLicenseId = B.BusinessLicenseId
		inner join TbSecurt C on A.CampaignId=C.CampaignId
		inner join TbCampaignRegister D on A.CampaignId=D.CampaignId
		inner join TbCampaignStatus E on A.CampaignId=E.CampaignId
		WHERE E.EqCamStats = 'E100000000' and A.DpsOrgnztn = 'DPS0000002' and date(E.UpdateDate)= #{date}
	) X, (SELECT @ROWNUM := 0) R
  </select>  
  
  <update id="updateProcStatus" parameterType="string" >
    update TbIbkOfferIfInfo
    set ProcStatus = #{procStatus}
    where ProcStatus = 'R'
  </update>
</mapper>